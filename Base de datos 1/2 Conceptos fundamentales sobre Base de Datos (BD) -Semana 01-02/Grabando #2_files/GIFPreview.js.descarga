'use strict';"object"!==typeof window.GIFPreview&&(window.GIFPreview=function(z){function v(){for(let c of a.framesArray)if(0===c)return;a.framesCollecting=!1;a.framesCollectingWaitingCallback&&(a.framesCollectingWaitingCallback(),a.framesCollectingWaitingCallback=void 0)}function w(c,d,m,l){a.framesCollecting=!0;a.framesArray=[];let k,p,g=a.outputFrameRate*a.outputCaptureSec,b=0,n=function(){let f=0,r=0,q=e.videoWidth,h=e.videoHeight;l&&(f=l.x,r=l.y,q=l.width,h=l.height);let t=h*a.outputWidth/q;
void 0===k&&(k=document.createElement("canvas"),k.width=a.outputWidth,k.height=Math.min(a.outputMaxHeight,t),p=k.getContext("2d"),a.framesHeight=k.height);let x=void 0===m?"ended"!==c.getTracks()[0].readyState:e.currentTime<(d+m)/1E3;if(x){p.drawImage(e,f,r,q,h,0,0,k.width,t);let y=b++;a.framesArray[y]=0;k.toBlob(function(A){a.framesArray[y]=A;0<g||v()});g--}else g=0;0===g&&(console.log("GIF done collecting frames. (currentTime: "+e.currentTime+" streamActive: "+x+" numFrames: "+a.framesArray.length+
")"),e.removeEventListener("timeupdate",n),e.pause(),v())},e=document.createElement("video");e.muted=!0;e.autoplay=!0;e.playsInline=!0;void 0===d?e.srcObject=c:(e.src=c,e.currentTime=d/1E3);e.addEventListener("timeupdate",n);e.play()}function B(c){let d=new GIFEncoder;d.setRepeat(0);d.setDelay(1E3/a.outputFrameRate);d.setQuality(a.outputQuality);if(d.start()){var m=Utils.formatMSToSec(a.durationMS+(0!==a.durationMS%1E3?1E3:0)),l=0,k=a.playIconImg,p=a.spIconImg;var g=document.createElement("canvas");
g.width=a.outputWidth;g.height=a.framesHeight;var b=g.getContext("2d",{willReadFrequently:!0});b.font="16px arial";l=b.measureText(m).width;var n=10+p.width+l+10+10,e=document.createElement("img");e.onload=function(){b.drawImage(e,0,0,g.width,g.height);if(!u.get("drawNoOverlays")){b.drawImage(k,(g.width-k.width)/2,(g.height-k.height)/2);b.fillStyle="#0e1637";var f=g.height-40-10,r={upperRight:10,lowerRight:10},q=!1,h={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};"undefined"==typeof q&&(q=!0);
if("object"===typeof r)for(var t in r)h[t]=r[t];b.beginPath();b.moveTo(0+h.upperLeft,f);b.lineTo(0+n-h.upperRight,f);b.quadraticCurveTo(0+n,f,0+n,f+h.upperRight);b.lineTo(0+n,f+40-h.lowerRight);b.quadraticCurveTo(0+n,f+40,0+n-h.lowerRight,f+40);b.lineTo(0+h.lowerLeft,f+40);b.quadraticCurveTo(0,f+40,0,f+40-h.lowerLeft);b.lineTo(0,f+h.upperLeft);b.quadraticCurveTo(0,f,0+h.upperLeft,f);b.closePath();q&&b.stroke();b.fill();b.drawImage(p,10,g.height-40-10+(40-p.height)/2);b.fillStyle="#ffffff";b.fillText(m,
10+p.width+10,g.height-14-10)}u.get("drawBorder")&&(b.lineWidth=1,b.strokeStyle="#000000",b.strokeRect(0,0,g.width,g.height));d.addFrame(b);a.framesArray.length?e.src=URL.createObjectURL(a.framesArray.shift()):(f=new Blob([new Uint8Array(d.stream().bin)],{type:"image/gif"}),c(f),a.framesArray=[],d.stream().bin=[])};e.src=URL.createObjectURL(a.framesArray.shift())}else console.error("GIF preview create failed since gifEncoder.start() failed."),c(void 0)}let a={};const u=OffscreenProxy.for("GIFPreview");
(function(){a.outputWidth=300;a.outputMaxHeight=208;a.outputFrameRate=5;a.outputCaptureSec=3;a.outputQuality=5;a.outputDurationMS=3E3;a.durationMS=0;a.framesArray=[];a.framesHeight=0;a.framesCollecting=!1;a.framesCollectingWaitingCallback=void 0;let c="chrome"in z&&chrome.runtime&&chrome.runtime.getURL;var d=document.createElement("img");d.src=c?chrome.runtime.getURL("app/images/gif-play-icon.png"):"../app/images/gif-play-icon.png";a.playIconImg=d;d=document.createElement("img");d.src=c?chrome.runtime.getURL("app/images/gif-sp-icon.png"):
"../app/images/gif-sp-icon.png";a.spIconImg=d})();a.isEnabled=function(){return u.get("enabled")};a.setDuration=function(c){a.durationMS=c};a.collectFrames=function(c){a.blob=null;a.isEnabled()?(console.log("Starting GIF preview create."),w(c)):console.log("Not doing GIF preview since we're disabled.")};a.collectFramesAfterTrim=function(c,d,m,l){a.blob=null;a.isEnabled()?(console.log("Starting GIF preview create from fileSrc."),w(c,d,m,l)):console.log("Not doing GIF preview since we're disabled.")};
a.getBlob=function(c){if(a.isEnabled())if(a.blob)c(a.blob);else if(a.framesCollecting)console.log("GIF frames still collecting so waiting for them to be done"),a.framesCollectingWaitingCallback=function(){a.getBlob(c)};else{var d=(new Date).getTime();B(m=>{console.log("GIF getBlob took: "+((new Date).getTime()-d));c(m)})}else c(void 0)};return a}(window));