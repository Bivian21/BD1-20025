/**
 * This class handles LZW encoding
 * Adapted from Jef Poskanzer's Java port by way of J. M. G. Elliott.
 * @author Kevin Weiner (original Java version - kweiner@fmsware.com)
 * @author Thibault Imbert (AS3 version - bytearray.org)
 * @author Kevin Kwok (JavaScript version - https://github.com/antimatter15/jsgif)
 * @version 0.1 AS3 implementation
 */

LZWEncoder=function(){var c,d,e,f,g,h,i,j,k,l,m,n,a={},o=[],p=[],q=0,r=!1,s=0,t=0,u=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],v=[],b=a.LZWEncoder=function(a,b,g,h){c=a,d=b,e=g,f=Math.max(2,h)},w=function(a,b){v[n++]=a,n>=254&&A(b)},x=function(a){y(5003),q=l+2,r=!0,D(l,a)},y=function(b){for(var a=0;a<b;++a)o[a]=-1},z=a.compress=function(s,d){var c,a,f,b,g,h,e;for(c=5003,r=!1,j=B(i=k=s),l=1<<s-1,m=l+1,q=l+2,n=0,b=C(),e=0;c<65536;c*=2)++e;e=8-e,y(h=5003),D(l,d);outer_loop:for(;-1!=(f=C());){if(c=(f<<12)+b,a=f<<e^b,o[a]==c){b=p[a];continue}if(o[a]>=0){g=h-a,0===a&&(g=1);do if((a-=g)<0&&(a+=h),o[a]==c){b=p[a];continue outer_loop}while(o[a]>=0)}D(b,d),b=f,q<4096?(p[a]=q++,o[a]=c):x(d)}D(b,d),D(m,d)};a.encode=function(a){a.writeByte(f),g=c*d,h=0,z(f+1,a),a.writeByte(0)};var A=function(a){n>0&&(a.writeByte(n),a.writeBytes(v,0,n),n=0)},B=function(a){return(1<<a)-1},C=function(){return 0===g?-1:(--g,255&e[h++])},D=function(a,b){for(s&=u[t],t>0?s|=a<<t:s=a,t+=i;t>=8;)w(255&s,b),s>>=8,t-=8;if((q>j||r)&&(r?(j=B(i=k),r=!1):(++i,j=12==i?4096:B(i))),a==m){for(;t>0;)w(255&s,b),s>>=8,t-=8;A(b)}};return b.apply(this,arguments),a}