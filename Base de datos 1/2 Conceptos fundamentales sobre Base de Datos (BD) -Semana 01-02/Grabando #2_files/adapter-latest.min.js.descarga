/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 !function(a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=a()}(function(){return(function(){function a(e,f,c){function d(b,k){if(!f[b]){if(!e[b]){var i="function"==typeof require&&require;if(!k&&i)return i(b,!0);if(g)return g(b,!0);var j=new Error("Cannot find module '"+b+"'");throw j.code="MODULE_NOT_FOUND",j}var h=f[b]={exports:{}};e[b][0].call(h.exports,function(a){return d(e[b][1][a]||a)},h,h.exports,a,e,f,c)}return f[b].exports}for(var g="function"==typeof require&&require,b=0;b<c.length;b++)d(c[b]);return d}return a})()({1:[function(a,b,d){"use strict";var c=(0,a("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});b.exports=c},{"./adapter_factory.js":2}],2:[function(a,i,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.adapterFactory=function(){var f=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},b=f.window,e=arguments.length>1&& void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},c=j.log,a=j.detectBrowser(b),d={browserDetails:a,commonShim:n,extractVersion:j.extractVersion,disableLog:j.disableLog,disableWarnings:j.disableWarnings,sdp:o};switch(a.browser){case"chrome":if(!k||!k.shimPeerConnection||!e.shimChrome){c("Chrome shim is not included in this adapter release.");break}if(null===a.version){c("Chrome shim can not determine version, not shimming.");break}c("adapter.js shimming chrome."),d.browserShim=k,n.shimAddIceCandidateNullOrEmpty(b,a),k.shimGetUserMedia(b,a),k.shimMediaStream(b,a),k.shimPeerConnection(b,a),k.shimOnTrack(b,a),k.shimAddTrackRemoveTrack(b,a),k.shimGetSendersWithDtmf(b,a),k.shimGetStats(b,a),k.shimSenderReceiverGetStats(b,a),k.fixNegotiationNeeded(b,a),n.shimRTCIceCandidate(b,a),n.shimConnectionState(b,a),n.shimMaxMessageSize(b,a),n.shimSendThrowTypeError(b,a),n.removeExtmapAllowMixed(b,a);break;case"firefox":if(!l||!l.shimPeerConnection||!e.shimFirefox){c("Firefox shim is not included in this adapter release.");break}c("adapter.js shimming firefox."),d.browserShim=l,n.shimAddIceCandidateNullOrEmpty(b,a),l.shimGetUserMedia(b,a),l.shimPeerConnection(b,a),l.shimOnTrack(b,a),l.shimRemoveStream(b,a),l.shimSenderGetStats(b,a),l.shimReceiverGetStats(b,a),l.shimRTCDataChannel(b,a),l.shimAddTransceiver(b,a),l.shimGetParameters(b,a),l.shimCreateOffer(b,a),l.shimCreateAnswer(b,a),n.shimRTCIceCandidate(b,a),n.shimConnectionState(b,a),n.shimMaxMessageSize(b,a),n.shimSendThrowTypeError(b,a);break;case"safari":if(!m||!e.shimSafari){c("Safari shim is not included in this adapter release.");break}c("adapter.js shimming safari."),d.browserShim=m,n.shimAddIceCandidateNullOrEmpty(b,a),m.shimRTCIceServerUrls(b,a),m.shimCreateOfferLegacy(b,a),m.shimCallbacksAPI(b,a),m.shimLocalStreamsAPI(b,a),m.shimRemoteStreamsAPI(b,a),m.shimTrackEventTransceiver(b,a),m.shimGetUserMedia(b,a),m.shimAudioContext(b,a),n.shimRTCIceCandidate(b,a),n.shimMaxMessageSize(b,a),n.shimSendThrowTypeError(b,a),n.removeExtmapAllowMixed(b,a);break;default:c("Unsupported browser!")}return d};var c=a("./utils"),j=p(c),d=a("./chrome/chrome_shim"),k=p(d),e=a("./firefox/firefox_shim"),l=p(e),f=a("./safari/safari_shim"),m=p(f),g=a("./common_shim"),n=p(g),h=a("sdp"),o=p(h);function p(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=a.shimGetUserMedia=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=b("./getusermedia");Object.defineProperty(a,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}});var f=b("./getdisplaymedia");Object.defineProperty(a,"shimGetDisplayMedia",{enumerable:!0,get:function(){return f.shimGetDisplayMedia}}),a.shimMediaStream=function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},a.shimOnTrack=function(a){if((void 0===a?"undefined":d(a))!=="object"||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)g.wrapPeerConnectionEvent(a,"track",function(a){return a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return this._ontrackpoly||(this._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(f){var e=void 0;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===f.track.id}):{track:f.track};var d=new Event("track");d.track=f.track,d.receiver=e,d.transceiver={receiver:e},d.streams=[b.stream],c.dispatchEvent(d)}),b.stream.getTracks().forEach(function(f){var e=void 0;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===f.id}):{track:f};var d=new Event("track");d.track=f,d.receiver=e,d.transceiver={receiver:e},d.streams=[b.stream],c.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}},a.shimGetSendersWithDtmf=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(b,a){return{track:a,get dtmf(){return void 0===this._dtmf&&("audio"===a.kind?this._dtmf=b.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:b}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(d,e){var a=c.apply(this,arguments);return a||(a=b(this,d),this._senders.push(a)),a};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(b){e.apply(this,arguments);var a=this._senders.indexOf(b);-1!==a&&this._senders.splice(a,1)}}var f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;this._senders=this._senders||[],f.apply(this,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;this._senders=this._senders||[],g.apply(this,[a]),a.getTracks().forEach(function(c){var a=b._senders.find(function(a){return a.track===c});a&&b._senders.splice(b._senders.indexOf(a),1)})}}else if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var h=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var b=this,a=h.apply(this,[]);return a.forEach(function(a){return a._pc=b}),a},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},a.shimGetStats=function(a){if(a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){var g=this,a=Array.prototype.slice.call(arguments),c=a[0],d=a[1],e=a[2];if(arguments.length>0&&"function"==typeof c)return b.apply(this,arguments);if(0===b.length&&(0===arguments.length||"function"!=typeof c))return b.apply(this,[]);var h=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},i=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var f=function(a){d(i(h(a)))};return b.apply(this,[f,c])}return new Promise(function(c,a){b.apply(g,[function(a){c(i(h(a)))},a])}).then(d,e)}}},a.shimSenderReceiverGetStats=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver){if(!("getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var c=this,a=b.apply(this,[]);return a.forEach(function(a){return a._pc=c}),a});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return g.filterStats(b,a.track,!0)})}}if(!("getStats"in a.RTCRtpReceiver.prototype)){var e=a.RTCPeerConnection.prototype.getReceivers;e&&(a.RTCPeerConnection.prototype.getReceivers=function(){var b=this,a=e.apply(this,[]);return a.forEach(function(a){return a._pc=b}),a}),g.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return g.filterStats(b,a.track,!1)})}}if("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype){var f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){var e=arguments[0],b=void 0,c=void 0,d=void 0;return(this.getSenders().forEach(function(a){a.track===e&&(b?d=!0:b=a)}),this.getReceivers().forEach(function(a){return a.track===e&&(c?d=!0:c=a),a.track===e}),d||b&&c)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):b?b.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return f.apply(this,arguments)}}}},a.shimAddTrackRemoveTrackWithNative=i,a.shimAddTrackRemoveTrack=function(a,b){if(a.RTCPeerConnection){if(a.RTCPeerConnection.prototype.addTrack&&b.version>=65)return i(a);var c=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var b=this,a=c.apply(this);return this._reverseStreams=this._reverseStreams||{},a.map(function(a){return b._reverseStreams[a.id]})};var d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var e=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.getTracks().forEach(function(a){if(e.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[b.id]){var c=new a.MediaStream(b.getTracks());this._streams[b.id]=c,this._reverseStreams[c.id]=b,b=c}d.apply(this,[b])};var e=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.apply(this,[this._streams[a.id]||a]),delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id],delete this._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(d,b){var g=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===d}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(a){return a.track===d}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var f=this._streams[b.id];if(f)f.addTrack(d),Promise.resolve().then(function(){g.dispatchEvent(new Event("negotiationneeded"))});else{var c=new a.MediaStream([d]);this._streams[b.id]=c,this._reverseStreams[c.id]=b,this.addStream(c)}return this.getSenders().find(function(a){return a.track===d})},["createOffer","createAnswer"].forEach(function(b){var d=a.RTCPeerConnection.prototype[b],c=h({},b,function(){var b=this,c=arguments,a=arguments.length&&"function"==typeof arguments[0];return a?d.apply(this,[function(a){var d=j(b,a);c[0].apply(null,[d])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(this,arguments).then(function(a){return j(b,a)})});a.RTCPeerConnection.prototype[b]=c[b]});var f=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var b,a,c;return arguments.length&&arguments[0].type&&(arguments[0]=(b=this,a=arguments[0],c=a.sdp,Object.keys(b._reverseStreams||[]).forEach(function(d){var a=b._reverseStreams[d],e=b._streams[a.id];c=c.replace(new RegExp(a.id,"g"),e.id)}),new RTCSessionDescription({type:a.type,sdp:c}))),f.apply(this,arguments)};var g=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=g.get.apply(this);return""===a.type?a:j(this,a)}}),a.RTCPeerConnection.prototype.removeTrack=function(b){var c=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!b._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(b._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var a=void 0;Object.keys(this._streams).forEach(function(d){c._streams[d].getTracks().find(function(a){return b.track===a})&&(a=c._streams[d])}),a&&(1===a.getTracks().length?this.removeStream(this._reverseStreams[a.id]):a.removeTrack(b.track),this.dispatchEvent(new Event("negotiationneeded")))}}function j(b,a){var c=a.sdp;return Object.keys(b._reverseStreams||[]).forEach(function(d){var a=b._reverseStreams[d],e=b._streams[a.id];c=c.replace(new RegExp(e.id,"g"),a.id)}),new RTCSessionDescription({type:a.type,sdp:c})}},a.shimPeerConnection=function(a,b){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var d=a.RTCPeerConnection.prototype[b],c=h({},b,function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)});a.RTCPeerConnection.prototype[b]=c[b]})},a.fixNegotiationNeeded=function(a,b){g.wrapPeerConnectionEvent(a,"negotiationneeded",function(c){var a=c.target;if(!(b.version<72)&&(!a.getConfiguration||"plan-b"!==a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return c})};var g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(b("../utils.js"));function h(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function i(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(d,a){if(!a)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var c=b.apply(this,arguments);return this._shimmedLocalStreams[a.id]?-1===this._shimmedLocalStreams[a.id].indexOf(c)&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var d=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(function(a){if(d.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")});var e=this.getSenders();c.apply(this,arguments);var b=this.getSenders().filter(function(a){return -1===e.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(b)};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var d=b._shimmedLocalStreams[c].indexOf(a);-1!==d&&b._shimmedLocalStreams[c].splice(d,1),1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]}),e.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=function(a,b){if((!a.navigator.mediaDevices||!("getDisplayMedia"in a.navigator.mediaDevices))&&a.navigator.mediaDevices){if("function"!=typeof b){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}a.navigator.mediaDevices.getDisplayMedia=function(c){return b(c).then(function(e){var b=c.video&&c.video.width,d=c.video&&c.video.height,f=c.video&&c.video.frameRate;return c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:f||3}},b&&(c.video.mandatory.maxWidth=b),d&&(c.video.mandatory.maxHeight=d),a.navigator.mediaDevices.getUserMedia(c)})}}}},{}],5:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.shimGetUserMedia=function(b,c){var a=b&&b.navigator;if(a.mediaDevices){var f=function(a){if((void 0===a?"undefined":d(a))!=="object"||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var c="object"===d(a[e])?a[e]:{ideal:a[e]};void 0!==c.exact&&"number"==typeof c.exact&&(c.min=c.max=c.exact);var g=function(b,a){return b?b+a.charAt(0).toUpperCase()+a.slice(1):"deviceId"===a?"sourceId":a};if(void 0!==c.ideal){b.optional=b.optional||[];var f={};"number"==typeof c.ideal?(f[g("min",e)]=c.ideal,b.optional.push(f),(f={})[g("max",e)]=c.ideal,b.optional.push(f)):(f[g("",e)]=c.ideal,b.optional.push(f))}void 0!==c.exact&&"number"!=typeof c.exact?(b.mandatory=b.mandatory||{},b.mandatory[g("",e)]=c.exact):["min","max"].forEach(function(a){void 0!==c[a]&&(b.mandatory=b.mandatory||{},b.mandatory[g(a,e)]=c[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(b,i){if(c.version>=61)return i(b);if((b=JSON.parse(JSON.stringify(b)))&&"object"===d(b.audio)){var j=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};j((b=JSON.parse(JSON.stringify(b))).audio,"autoGainControl","googAutoGainControl"),j(b.audio,"noiseSuppression","googNoiseSuppression"),b.audio=f(b.audio)}if(b&&"object"===d(b.video)){var g=b.video.facingMode;g=g&&((void 0===g?"undefined":d(g))==="object"?g:{ideal:g});var k=c.version<66;if(g&&("user"===g.exact||"environment"===g.exact||"user"===g.ideal||"environment"===g.ideal)&&!(a.mediaDevices.getSupportedConstraints&&a.mediaDevices.getSupportedConstraints().facingMode&&!k)){delete b.video.facingMode;var h=void 0;if("environment"===g.exact||"environment"===g.ideal?h=["back","rear"]:("user"===g.exact||"user"===g.ideal)&&(h=["front"]),h)return a.mediaDevices.enumerateDevices().then(function(a){var c=(a=a.filter(function(a){return"videoinput"===a.kind})).find(function(a){return h.some(function(b){return a.label.toLowerCase().includes(b)})});return!c&&a.length&&h.includes("back")&&(c=a[a.length-1]),c&&(b.video.deviceId=g.exact?{exact:c.deviceId}:{ideal:c.deviceId}),b.video=f(b.video),e("chrome: "+JSON.stringify(b)),i(b)})}b.video=f(b.video)}return e("chrome: "+JSON.stringify(b)),i(b)},h=function(a){return c.version>=64?a:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(a.getUserMedia=(function(b,c,d){g(b,function(b){a.webkitGetUserMedia(b,c,function(a){d&&d(h(a))})})}).bind(a),a.mediaDevices.getUserMedia){var i=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return g(a,function(a){return i(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}}};var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(b("../utils.js")).log},{"../utils.js":11}],6:[function(c,d,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var b,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.shimRTCIceCandidate=function(a){if(a.RTCIceCandidate&&(!a.RTCIceCandidate||!("foundation"in a.RTCIceCandidate.prototype))){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if((void 0===a?"undefined":e(a))==="object"&&a.candidate&&0===a.candidate.indexOf("a=")&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){var d=new b(a),g=f.default.parseCandidate(a.candidate),c=Object.assign(d,g);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,g.wrapPeerConnectionEvent(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},a.shimMaxMessageSize=function(a,b){if(a.RTCPeerConnection){"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var c=function(a){if(!a||!a.sdp)return!1;var b=f.default.splitSections(a.sdp);return b.shift(),b.some(function(b){var a=f.default.parseMLine(b);return a&&"application"===a.kind&& -1!==a.protocol.indexOf("SCTP")})},d=function(c){var a=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||a.length<2)return -1;var b=parseInt(a[1],10);return b!=b?-1:b},e=function(c){var a=65536;return"firefox"===b.browser&&(a=b.version<57?-1===c?16384:2147483637:b.version<60?57===b.version?65535:65536:2147483637),a},g=function(d,e){var a=65536;"firefox"===b.browser&&57===b.version&&(a=65535);var c=f.default.matchPrefix(d.sdp,"a=max-message-size:");return c.length>0?a=parseInt(c[0].substr(19),10):"firefox"===b.browser&& -1!==e&&(a=2147483637),a},h=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===b.browser&&b.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),c(arguments[0])){var i=d(arguments[0]),a=e(i),f=g(arguments[0],i),k=void 0;k=0===a&&0===f?Number.POSITIVE_INFINITY:0===a||0===f?Math.max(a,f):Math.min(a,f);var j={};Object.defineProperty(j,"maxMessageSize",{get:function(){return k}}),this._sctp=j}return h.apply(this,arguments)}}},a.shimSendThrowTypeError=function(a){if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var b=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=b.apply(this,arguments);return c(a,this),a},g.wrapPeerConnectionEvent(a,"datachannel",function(a){return c(a.channel,a.target),a})}function c(a,b){var c=a.send;a.send=function(){var d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}},a.shimConnectionState=function(a){if(a.RTCPeerConnection&&!("connectionState"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get:function(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(a){var c=b[a];b[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(b){var a=b.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;var c=new Event("connectionstatechange",b);a.dispatchEvent(c)}return b},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}},a.removeExtmapAllowMixed=function(b,a){if(b.RTCPeerConnection&&("chrome"!==a.browser||!(a.version>=71))&&("safari"!==a.browser||!(a.version>=605))){var c=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&& -1!==a.sdp.indexOf("\na=extmap-allow-mixed")){var d=a.sdp.split("\n").filter(function(a){return"a=extmap-allow-mixed"!==a.trim()}).join("\n");b.RTCSessionDescription&&a instanceof b.RTCSessionDescription?arguments[0]=new b.RTCSessionDescription({type:a.type,sdp:d}):a.sdp=d}return c.apply(this,arguments)}}},a.shimAddIceCandidateNullOrEmpty=function(a,c){if(a.RTCPeerConnection&&a.RTCPeerConnection.prototype){var b=a.RTCPeerConnection.prototype.addIceCandidate;b&&0!==b.length&&(a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===c.browser&&c.version<78||"firefox"===c.browser&&c.version<68||"safari"===c.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():b.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}};var f=(b=c("sdp"))&&b.__esModule?b:{default:b},g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(c("./utils"))},{"./utils":11,sdp:12}],7:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=a.shimGetUserMedia=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=b("./getusermedia");Object.defineProperty(a,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}});var f=b("./getdisplaymedia");Object.defineProperty(a,"shimGetDisplayMedia",{enumerable:!0,get:function(){return f.shimGetDisplayMedia}}),a.shimOnTrack=function(a){(void 0===a?"undefined":d(a))==="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},a.shimPeerConnection=function(a,b){if((void 0===a?"undefined":d(a))==="object"&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var d=a.RTCPeerConnection.prototype[b],c=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}({},b,function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)});a.RTCPeerConnection.prototype[b]=c[b]});var c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){var a=Array.prototype.slice.call(arguments),d=a[0],f=a[1],g=a[2];return e.apply(this,[d||null]).then(function(a){if(b.version<53&&!f)try{a.forEach(function(a){a.type=c[a.type]||a.type})}catch(d){if("TypeError"!==d.name)throw d;a.forEach(function(b,d){a.set(d,Object.assign({},b,{type:c[b.type]||b.type}))})}return a}).then(f,g)}}},a.shimSenderGetStats=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpSender.prototype))){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var c=this,a=b.apply(this,[]);return a.forEach(function(a){return a._pc=c}),a});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},a.shimReceiverGetStats=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpReceiver.prototype))){var b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){var c=this,a=b.apply(this,[]);return a.forEach(function(a){return a._pc=c}),a}),g.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},a.shimRemoveStream=function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;g.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&a.getTracks().includes(c.track)&&b.removeTrack(c)})})},a.shimRTCDataChannel=function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)},a.shimAddTransceiver=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.addTransceiver;b&&(a.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var a=arguments[1],e=a&&"sendEncodings"in a;e&&a.sendEncodings.forEach(function(a){if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var f=b.apply(this,arguments);if(e){var d=f.sender,c=d.getParameters();"encodings"in c&&(1!==c.encodings.length||0!==Object.keys(c.encodings[0]).length)||(c.encodings=a.sendEncodings,d.sendEncodings=a.sendEncodings,this.setParametersPromises.push(d.setParameters(c).then(function(){delete d.sendEncodings}).catch(function(){delete d.sendEncodings})))}return f})}},a.shimGetParameters=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCRtpSender){var b=a.RTCRtpSender.prototype.getParameters;b&&(a.RTCRtpSender.prototype.getParameters=function(){var a=b.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}},a.shimCreateOffer=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(){var a=this,c=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return b.apply(a,c)}).finally(function(){a.setParametersPromises=[]}):b.apply(this,arguments)}}},a.shimCreateAnswer=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.createAnswer;a.RTCPeerConnection.prototype.createAnswer=function(){var a=this,c=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return b.apply(a,c)}).finally(function(){a.setParametersPromises=[]}):b.apply(this,arguments)}}};var g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(b("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=function(a,b){a.navigator.mediaDevices&&"getDisplayMedia"in a.navigator.mediaDevices||!a.navigator.mediaDevices||(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!(c&&c.video)){var d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)})}},{}],9:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.shimGetUserMedia=function(c,f){var b=c&&c.navigator,a=c&&c.MediaStreamTrack;if(b.getUserMedia=function(a,c,d){e.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),b.mediaDevices.getUserMedia(a).then(c,d)},!(f.version>55&&"autoGainControl"in b.mediaDevices.getSupportedConstraints())){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},h=b.mediaDevices.getUserMedia.bind(b.mediaDevices);if(b.mediaDevices.getUserMedia=function(a){return(void 0===a?"undefined":d(a))==="object"&&"object"===d(a.audio)&&(g((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","mozAutoGainControl"),g(a.audio,"noiseSuppression","mozNoiseSuppression")),h(a)},a&&a.prototype.getSettings){var i=a.prototype.getSettings;a.prototype.getSettings=function(){var a=i.apply(this,arguments);return g(a,"mozAutoGainControl","autoGainControl"),g(a,"mozNoiseSuppression","noiseSuppression"),a}}if(a&&a.prototype.applyConstraints){var j=a.prototype.applyConstraints;a.prototype.applyConstraints=function(a){return"audio"===this.kind&&(void 0===a?"undefined":d(a))==="object"&&(g(a=JSON.parse(JSON.stringify(a)),"autoGainControl","mozAutoGainControl"),g(a,"noiseSuppression","mozNoiseSuppression")),j.apply(this,[a])}}}};var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(b("../utils"))},{"../utils":11}],10:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.shimLocalStreamsAPI=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(function(d){return b.call(c,d,a)}),a.getVideoTracks().forEach(function(d){return b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(e){for(var f=this,c=arguments.length,d=Array(c>1?c-1:0),a=1;a<c;a++)d[a-1]=arguments[a];return d&&d.forEach(function(a){f._localStreams?f._localStreams.includes(a)||f._localStreams.push(a):f._localStreams=[a]}),b.apply(this,arguments)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var c=this;this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var d=a.getTracks();this.getSenders().forEach(function(a){d.includes(a.track)&&c.removeTrack(a)})}})}},a.shimRemoteStreamsAPI=function(a){if((void 0===a?"undefined":d(a))==="object"&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){if(b._remoteStreams||(b._remoteStreams=[]),!b._remoteStreams.includes(a)){b._remoteStreams.push(a);var c=new Event("addstream");c.stream=a,b.dispatchEvent(c)}})})}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){if(a._remoteStreams||(a._remoteStreams=[]),!(a._remoteStreams.indexOf(b)>=0)){a._remoteStreams.push(b);var c=new Event("addstream");c.stream=b,a.dispatchEvent(c)}})}),b.apply(a,arguments)}}},a.shimCallbacksAPI=function(c){if((void 0===c?"undefined":d(c))==="object"&&c.RTCPeerConnection){var a=c.RTCPeerConnection.prototype,e=a.createOffer,f=a.createAnswer,g=a.setLocalDescription,h=a.setRemoteDescription,i=a.addIceCandidate;a.createOffer=function(c,a){var d=arguments.length>=2?arguments[2]:arguments[0],b=e.apply(this,[d]);return a?(b.then(c,a),Promise.resolve()):b},a.createAnswer=function(c,a){var d=arguments.length>=2?arguments[2]:arguments[0],b=f.apply(this,[d]);return a?(b.then(c,a),Promise.resolve()):b};var b=function(c,d,a){var b=g.apply(this,[c]);return a?(b.then(d,a),Promise.resolve()):b};a.setLocalDescription=b,b=function(c,d,a){var b=h.apply(this,[c]);return a?(b.then(d,a),Promise.resolve()):b},a.setRemoteDescription=b,b=function(c,d,a){var b=i.apply(this,[c]);return a?(b.then(d,a),Promise.resolve()):b},a.addIceCandidate=b}},a.shimGetUserMedia=function(b){var a=b&&b.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){var c=a.mediaDevices,d=c.getUserMedia.bind(c);a.mediaDevices.getUserMedia=function(a){return d(f(a))}}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=(function(b,c,d){a.mediaDevices.getUserMedia(b).then(c,d)}).bind(a))},a.shimConstraints=f,a.shimRTCIceServerUrls=function(a){if(a.RTCPeerConnection){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,g){if(a&&a.iceServers){for(var f=[],d=0;d<a.iceServers.length;d++){var c=a.iceServers[d];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(e.deprecated("RTCIceServer.url","RTCIceServer.urls"),(c=JSON.parse(JSON.stringify(c))).urls=c.url,delete c.url,f.push(c)):f.push(a.iceServers[d])}a.iceServers=f}return new b(a,g)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})}},a.shimTrackEventTransceiver=function(a){(void 0===a?"undefined":d(a))==="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},a.shimCreateOfferLegacy=function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var c=this.getTransceivers().find(function(a){return"audio"===a.receiver.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio"),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);var d=this.getTransceivers().find(function(a){return"video"===a.receiver.track.kind});!1===a.offerToReceiveVideo&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==a.offerToReceiveVideo||d||this.addTransceiver("video")}return b.apply(this,arguments)}},a.shimAudioContext=function(a){(void 0===a?"undefined":d(a))!=="object"||a.AudioContext||(a.AudioContext=a.webkitAudioContext)};var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(b("../utils"));function f(a){return a&& void 0!==a.video?Object.assign({},a,{video:e.compactObject(a.video)}):a}},{"../utils":11}],11:[function(b,c,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.extractVersion=g,a.wrapPeerConnectionEvent=function(b,c,d){if(b.RTCPeerConnection){var a=b.RTCPeerConnection.prototype,e=a.addEventListener;a.addEventListener=function(a,f){if(a!==c)return e.apply(this,arguments);var b=function(b){var a=d(b);a&&(f.handleEvent?f.handleEvent(a):f(a))};return this._eventMap=this._eventMap||{},this._eventMap[c]||(this._eventMap[c]=new Map),this._eventMap[c].set(f,b),e.apply(this,[a,b])};var f=a.removeEventListener;a.removeEventListener=function(b,a){if(b!==c||!this._eventMap||!this._eventMap[c]||!this._eventMap[c].has(a))return f.apply(this,arguments);var d=this._eventMap[c].get(a);return this._eventMap[c].delete(a),0===this._eventMap[c].size&&delete this._eventMap[c],0===Object.keys(this._eventMap).length&&delete this._eventMap,f.apply(this,[b,d])},Object.defineProperty(a,"on"+c,{get:function(){return this["_on"+c]},set:function(a){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),a&&this.addEventListener(c,this["_on"+c]=a)},enumerable:!0,configurable:!0})}},a.disableLog=function(a){return"boolean"!=typeof a?new Error("Argument type: "+(void 0===a?"undefined":d(a))+". Please use a boolean."):(e=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},a.disableWarnings=function(a){return"boolean"!=typeof a?new Error("Argument type: "+(void 0===a?"undefined":d(a))+". Please use a boolean."):(f=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},a.log=function(){("undefined"==typeof window?"undefined":d(window))!=="object"||e||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},a.deprecated=function(a,b){f&&console.warn(a+" is deprecated, please use "+b+" instead.")},a.detectBrowser=function(b){var a={browser:null,version:null};if(void 0===b||!b.navigator)return a.browser="Not a browser.",a;var c=b.navigator;return c.mozGetUserMedia?(a.browser="firefox",a.version=g(c.userAgent,/Firefox\/(\d+)\./,1)):c.webkitGetUserMedia|| !1===b.isSecureContext&&b.webkitRTCPeerConnection&&!b.RTCIceGatherer?(a.browser="chrome",a.version=g(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):b.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(a.browser="safari",a.version=g(c.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=b.RTCRtpTransceiver&&"currentDirection"in b.RTCRtpTransceiver.prototype):a.browser="Not a supported browser.",a},a.compactObject=i,a.walkStats=j,a.filterStats=function(b,c,d){var f=d?"outbound-rtp":"inbound-rtp",a=new Map;if(null===c)return a;var e=[];return b.forEach(function(a){"track"===a.type&&a.trackIdentifier===c.id&&e.push(a)}),e.forEach(function(c){b.forEach(function(d){d.type===f&&d.trackId===c.id&&j(b,d,a)})}),a};var e=!0,f=!0;function g(c,d,b){var a=c.match(d);return a&&a.length>=b&&parseInt(a[b],10)}function h(a){return"[object Object]"===Object.prototype.toString.call(a)}function i(a){return h(a)?Object.keys(a).reduce(function(g,c){var b,d,e,j=h(a[c]),f=j?i(a[c]):a[c],k=j&&!Object.keys(f).length;return void 0===f||k?g:Object.assign(g,(b={},d=c,e=f,d in b?Object.defineProperty(b,d,{value:e,enumerable:!0,configurable:!0,writable:!0}):b[d]=e,b))},{}):a}function j(c,a,b){!a||b.has(a.id)||(b.set(a.id,a),Object.keys(a).forEach(function(d){d.endsWith("Id")?j(c,c.get(a[d]),b):d.endsWith("Ids")&&a[d].forEach(function(a){j(c,c.get(a),b)})}))}},{}],12:[function(d,b,e){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a={};a.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},a.localCName=a.generateIdentifier(),a.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},a.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},a.getDescription=function(c){var b=a.splitSections(c);return b&&b[0]},a.getMediaSections=function(c){var b=a.splitSections(c);return b.shift(),b},a.matchPrefix=function(b,c){return a.splitLines(b).filter(function(a){return 0===a.indexOf(c)})},a.parseCandidate=function(d){for(var a=void 0,c={foundation:(a=0===d.indexOf("a=candidate:")?d.substring(12).split(" "):d.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[a[1]],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]},b=8;b<a.length;b+=2)switch(a[b]){case"raddr":c.relatedAddress=a[b+1];break;case"rport":c.relatedPort=parseInt(a[b+1],10);break;case"tcptype":c.tcpType=a[b+1];break;case"ufrag":c.ufrag=a[b+1],c.usernameFragment=a[b+1];break;default:void 0===c[a[b]]&&(c[a[b]]=a[b+1])}return c},a.writeCandidate=function(a){var b=[];b.push(a.foundation);var c=a.component;"rtp"===c?b.push(1):"rtcp"===c?b.push(2):b.push(c),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);var d=a.type;return b.push("typ"),b.push(d),"host"!==d&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},a.parseIceOptions=function(a){return a.substr(14).split(" ")},a.parseRtpMap=function(c){var a=c.substr(9).split(" "),b={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),b.name=a[0],b.clockRate=parseInt(a[1],10),b.channels=3===a.length?parseInt(a[2],10):1,b.numChannels=b.channels,b},a.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);var c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},a.parseExtmap=function(b){var a=b.substr(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1]}},a.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},a.parseFmtp=function(b){for(var c={},d=void 0,e=b.substr(b.indexOf(" ")+1).split(";"),a=0;a<e.length;a++)c[(d=e[a].trim().split("="))[0].trim()]=d[1];return c},a.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},a.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},a.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},a.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d> -1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},a.parseSsrcGroup=function(b){var a=b.substr(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(function(a){return parseInt(a,10)})}},a.getMid=function(c){var b=a.matchPrefix(c,"a=mid:")[0];if(b)return b.substr(6)},a.parseFingerprint=function(b){var a=b.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}},a.getDtlsParameters=function(b,c){return{role:"auto",fingerprints:a.matchPrefix(b+c,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},a.parseCryptoLine=function(b){var a=b.substr(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},a.writeCryptoLine=function(b){return"a=crypto:"+b.tag+" "+b.cryptoSuite+" "+("object"===c(b.keyParams)?a.writeCryptoKeyParams(b.keyParams):b.keyParams)+(b.sessionParams?" "+b.sessionParams.join(" "):"")+"\r\n"},a.parseCryptoKeyParams=function(b){if(0!==b.indexOf("inline:"))return null;var a=b.substr(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},a.getCryptoParameters=function(b,c){return a.matchPrefix(b+c,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(b,c){var d=a.matchPrefix(b+c,"a=ice-ufrag:")[0],e=a.matchPrefix(b+c,"a=ice-pwd:")[0];return d&&e?{usernameFragment:d.substr(12),password:e.substr(10)}:null},a.writeIceParameters=function(a){var b="a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n";return a.iceLite&&(b+="a=ice-lite\r\n"),b},a.parseRtpParameters=function(b){for(var d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},g=a.splitLines(b)[0].split(" "),e=3;e<g.length;e++){var f=g[e],h=a.matchPrefix(b,"a=rtpmap:"+f+" ")[0];if(h){var c=a.parseRtpMap(h),i=a.matchPrefix(b,"a=fmtp:"+f+" ");switch(c.parameters=i.length?a.parseFmtp(i[0]):{},c.rtcpFeedback=a.matchPrefix(b,"a=rtcp-fb:"+f+" ").map(a.parseRtcpFb),d.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(c.name.toUpperCase())}}}return a.matchPrefix(b,"a=extmap:").forEach(function(b){d.headerExtensions.push(a.parseExtmap(b))}),d},a.writeRtpDescription=function(e,c){var b="";b+="m="+e+" ",b+=c.codecs.length>0?"9":"0",b+=" UDP/TLS/RTP/SAVPF ",b+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",b+="c=IN IP4 0.0.0.0\r\n",b+="a=rtcp:9 IN IP4 0.0.0.0\r\n",c.codecs.forEach(function(c){b+=a.writeRtpMap(c),b+=a.writeFmtp(c),b+=a.writeRtcpFb(c)});var d=0;return c.codecs.forEach(function(a){a.maxptime>d&&(d=a.maxptime)}),d>0&&(b+="a=maxptime:"+d+"\r\n"),c.headerExtensions&&c.headerExtensions.forEach(function(c){b+=a.writeExtmap(c)}),b},a.parseRtpEncodingParameters=function(c){var d=[],f=a.parseRtpParameters(c),j=-1!==f.fecMechanisms.indexOf("RED"),k=-1!==f.fecMechanisms.indexOf("ULPFEC"),h=a.matchPrefix(c,"a=ssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"cname"===a.attribute}),g=h.length>0&&h[0].ssrc,i=void 0,e=a.matchPrefix(c,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,10)})});e.length>0&&e[0].length>1&&e[0][0]===g&&(i=e[0][1]),f.codecs.forEach(function(b){if("RTX"===b.name.toUpperCase()&&b.parameters.apt){var a={ssrc:g,codecPayloadType:parseInt(b.parameters.apt,10)};g&&i&&(a.rtx={ssrc:i}),d.push(a),j&&((a=JSON.parse(JSON.stringify(a))).fec={ssrc:g,mechanism:k?"red+ulpfec":"red"},d.push(a))}}),0===d.length&&g&&d.push({ssrc:g});var b=a.matchPrefix(c,"b=");return b.length&&(b=0===b[0].indexOf("b=TIAS:")?parseInt(b[0].substr(7),10):0===b[0].indexOf("b=AS:")?950*parseInt(b[0].substr(5),10)-16e3:void 0,d.forEach(function(a){a.maxBitrate=b})),d},a.parseRtcpParameters=function(c){var b={},d=a.matchPrefix(c,"a=ssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"cname"===a.attribute})[0];d&&(b.cname=d.value,b.ssrc=d.ssrc);var e=a.matchPrefix(c,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=a.matchPrefix(c,"a=rtcp-mux");return b.mux=f.length>0,b},a.writeRtcpParameters=function(a){var b="";return a.reducedSize&&(b+="a=rtcp-rsize\r\n"),a.mux&&(b+="a=rtcp-mux\r\n"),void 0!==a.ssrc&&a.cname&&(b+="a=ssrc:"+a.ssrc+" cname:"+a.cname+"\r\n"),b},a.parseMsid=function(c){var b=void 0,d=a.matchPrefix(c,"a=msid:");if(1===d.length)return{stream:(b=d[0].substr(7).split(" "))[0],track:b[1]};var e=a.matchPrefix(c,"a=ssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"msid"===a.attribute});if(e.length>0)return{stream:(b=e[0].value.split(" "))[0],track:b[1]}},a.parseSctpDescription=function(c){var h=a.parseMLine(c),d=a.matchPrefix(c,"a=max-message-size:"),b=void 0;d.length>0&&(b=parseInt(d[0].substr(19),10)),isNaN(b)&&(b=65536);var e=a.matchPrefix(c,"a=sctp-port:");if(e.length>0)return{port:parseInt(e[0].substr(12),10),protocol:h.fmt,maxMessageSize:b};var f=a.matchPrefix(c,"a=sctpmap:");if(f.length>0){var g=f[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:b}}},a.writeSctpDescription=function(b,a){var c=[];return c="DTLS/SCTP"!==b.protocol?["m="+b.kind+" 9 "+b.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+b.kind+" 9 "+b.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&c.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),c.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,21)},a.writeSessionBoilerplate=function(c,b,d){var e=void 0;return"v=0\r\no="+(d||"thisisadapterortc")+" "+(c||a.generateSessionId())+" "+(void 0!==b?b:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},a.getDirection=function(e,d){for(var c=a.splitLines(e),b=0;b<c.length;b++)switch(c[b]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[b].substr(2)}return d?a.getDirection(d):"sendrecv"},a.getKind=function(b){return a.splitLines(b)[0].split(" ")[0].substr(2)},a.isRejected=function(a){return"0"===a.split(" ",2)[1]},a.parseMLine=function(c){var b=a.splitLines(c)[0].substr(2).split(" ");return{kind:b[0],port:parseInt(b[1],10),protocol:b[2],fmt:b.slice(3).join(" ")}},a.parseOLine=function(c){var b=a.matchPrefix(c,"o=")[0].substr(2).split(" ");return{username:b[0],sessionId:b[1],sessionVersion:parseInt(b[2],10),netType:b[3],addressType:b[4],address:b[5]}},a.isValidSDP=function(c){if("string"!=typeof c||0===c.length)return!1;for(var d=a.splitLines(c),b=0;b<d.length;b++)if(d[b].length<2||"="!==d[b].charAt(1))return!1;return!0},(void 0===b?"undefined":c(b))==="object"&&(b.exports=a)},{}]},{},[1])(1)})