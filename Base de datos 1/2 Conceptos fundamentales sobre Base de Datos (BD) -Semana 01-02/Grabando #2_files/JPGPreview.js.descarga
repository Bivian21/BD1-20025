'use strict';"object"!==typeof window.JPGPreview&&(window.JPGPreview=function(A){function n(){for(let b of a.framesArray)if(0===b)return;a.framesCollecting=!1;a.framesCollectingWaitingCallback&&(a.framesCollectingWaitingCallback(),a.framesCollectingWaitingCallback=void 0)}function w(b,d){let f,e;b>a.outputMaxWidth&&(e=d*a.outputMaxWidth/b,f=a.outputMaxWidth);d>a.outputMaxHeight&&(f=b*a.outputMaxHeight/d,e=a.outputMaxHeight);return{w:f,h:e}}function p(b,d,f,e){a.framesCollecting=!0;a.framesArray=[];
let g,q,h=1,x=0,v=function(){let r=0,t=0,l=c.videoWidth,m=c.videoHeight;e&&(r=e.x,t=e.y,l=e.width,m=e.height);if(void 0===g){var k=w(l,m);g=document.createElement("canvas");g.width=k.w;g.height=k.h;q=g.getContext("2d")}if(k=void 0===f?"ended"!==b.getTracks()[0].readyState:c.currentTime<(d+f)/1E3){q.drawImage(c,r,t,l,m,0,0,g.width,g.height);let u=x++;a.framesArray[u]=0;g.toBlob(function(y){a.framesArray[u]=y;0<h||n()},"image/jpeg",.9);h--}else h=0;0===h&&(console.log("JPG done collecting frames. (currentTime: "+
c.currentTime+" streamActive: "+k+" numFrames: "+a.framesArray.length+")"),c.removeEventListener("timeupdate",v),c.pause(),n())},c=document.createElement("video");c.muted=!0;c.autoplay=!0;c.playsInline=!0;void 0===d?c.srcObject=b:(c.src=b,c.currentTime=d/1E3);c.addEventListener("timeupdate",v);c.play()}let a={outputMaxWidth:1280,outputMaxHeight:720};const z=OffscreenProxy.for("JPGPreview");a.isEnabled=function(){return z.get("enabled")};a.collectFrames=function(b){a.blob=null;a.isEnabled()?(console.log("Starting JPG preview create."),
p(b)):console.log("Not doing JPG preview since we're disabled.")};a.collectFramesAfterTrim=function(b,d,f,e){a.blob=null;a.isEnabled()?(console.log("Starting JPG preview create from fileSrc."),p(b,d,f,e)):console.log("Not doing JPG preview since we're disabled.")};a.getBlob=function(b){if(a.isEnabled())if(a.blob)b(a.blob);else if(a.framesCollecting)console.log("JPG frames still collecting so waiting for them to be done"),a.framesCollectingWaitingCallback=function(){a.getBlob(b)};else{var d=(new Date).getTime();
(f=>{console.log("JPG getBlob took: "+((new Date).getTime()-d));b(f)})(a.framesArray[0])}else b(void 0)};return a}(window));