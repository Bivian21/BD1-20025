/**
 * This class lets you encode animated GIF files
 * Base class :  http://www.java2s.com/Code/Java/2D-Graphics-GUI/AnimatedGifEncoder.htm
 * @author Kevin Weiner (original Java version - kweiner@fmsware.com)
 * @author Thibault Imbert (AS3 version - bytearray.org)
 * @author Kevin Kwok (JavaScript version - https://github.com/antimatter15/jsgif)
 * @version 0.1 AS3 implementation
 */

GIFEncoder=function(){for(var e,f,g,h,i,j,k,l,m,b=0,d={};b<256;b++)d[b]=String.fromCharCode(b);function c(){this.bin=[]}c.prototype.getData=function(){for(var b="",c=this.bin.length,a=0;a<c;a++)b+=d[this.bin[a]];return b},c.prototype.writeByte=function(a){this.bin.push(a)},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,c,d){for(var e=d||b.length,a=c||0;a<e;a++)this.writeByte(b[a])};var a={},n=null,o=-1,p=0,q=!1,r=[],s=7,t=-1,u=!1,v=!0,w=!1,x=10,y="Generated by jsgif (https://github.com/antimatter15/jsgif/)";a.setDelay=function(a){p=Math.round(a/10)},a.setDispose=function(a){a>=0&&(t=a)},a.setRepeat=function(a){a>=0&&(o=a)},a.setTransparent=function(a){n=a},a.setComment=function(a){y=a},a.addFrame=function(a,c){if(null===a||!q||null===h)throw new Error("Please call start method before calling addFrame");var b=!0;try{c?a instanceof ImageData?(i=a.data,sizeset&&e==a.width&&f==a.height||A(a.width,a.height)):a instanceof Uint8ClampedArray?a.length==e*f*4?i=a:(console.log("Please set the correct size: ImageData length mismatch"),b=!1):(console.log("Please provide correct input"),b=!1):(i=a.getImageData(0,0,a.canvas.width,a.canvas.height).data,w||A(a.canvas.width,a.canvas.height)),D(),B(),v&&(H(),J(),o>=0&&I()),E(),""!==y&&F(),G(),v||J(),L(),v=!1}catch(d){b=!1}return b},a.download=function(a){if(null===h|| !1==u)console.log("Please call start method and add frames and call finish method before calling download");else{a=void 0!==a?a.endsWith(".gif")?a:a+".gif":"download.gif";var b=document.createElement("a");b.download=a,b.href=URL.createObjectURL(new Blob([new Uint8Array(h.bin)],{type:"image/gif"})),b.click()}},a.finish=function(){if(!q)return!1;var a=!0;q=!1;try{h.writeByte(59),u=!0}catch(b){a=!1}return a};var z=function(){g=0,i=null,j=null,k=null,m=null,u=!1,v=!0};a.setFrameRate=function(a){15!=a&&(p=Math.round(100/a))},a.setQuality=function(a){a<1&&(a=1),x=a};var A=a.setSize=function(a,b){(!q||v)&&((e=a)<1&&(e=320),(f=b)<1&&(f=240),w=!0)};a.start=function(){z();var a=!0;u=!1,h=new c;try{h.writeUTFBytes("GIF89a")}catch(b){a=!1}return q=a},a.cont=function(){return z(),u=!1,h=new c,q=!0};var B=function(){var c=j.length,f=c/3;k=[];var d=new NeuQuant(j,c,x);m=d.process();for(var a=0,b=0;b<f;b++){var e=d.map(255&j[a++],255&j[a++],255&j[a++]);r[e]=!0,k[b]=e}j=null,l=8,s=7,null!==n&&(g=C(n))},C=function(b){if(null===m)return -1;for(var j=(16711680&b)>>16,k=(65280&b)>>8,l=255&b,c=0,d=16777216,n=m.length,a=0;a<n;){var e=j-(255&m[a++]),f=k-(255&m[a++]),g=l-(255&m[a]),h=e*e+f*f+g*g,i=a/3;r[i]&&h<d&&(d=h,c=i),a++}return c},D=function(){var h=e,k=f;j=[];for(var a=i,b=0,c=0;c<k;c++)for(var d=0;d<h;d++){var g=c*h*4+4*d;j[b++]=a[g],j[b++]=a[g+1],j[b++]=a[g+2]}},E=function(){var b,a;h.writeByte(33),h.writeByte(249),h.writeByte(4),null===n?(b=0,a=0):(b=1,a=2),t>=0&&(a=7&t),a<<=2,h.writeByte(0|a|0|b),K(p),h.writeByte(g),h.writeByte(0)},F=function(){h.writeByte(33),h.writeByte(254),h.writeByte(y.length),h.writeUTFBytes(y),h.writeByte(0)},G=function(){h.writeByte(44),K(0),K(0),K(e),K(f),v?h.writeByte(0):h.writeByte(128|s)},H=function(){K(e),K(f),h.writeByte(240|s),h.writeByte(0),h.writeByte(0)},I=function(){h.writeByte(33),h.writeByte(255),h.writeByte(11),h.writeUTFBytes("NETSCAPE2.0"),h.writeByte(3),h.writeByte(1),K(o),h.writeByte(0)},J=function(){h.writeBytes(m);for(var b=768-m.length,a=0;a<b;a++)h.writeByte(0)},K=function(a){h.writeByte(255&a),h.writeByte(a>>8&255)},L=function(){new LZWEncoder(e,f,k,l).encode(h)};return a.stream=function(){return h},a.setProperties=function(a,b){q=a,v=b},a}