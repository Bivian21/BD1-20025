'use strict';self.OffscreenProxy=function(){let f={callId:0,categories:[],port:void 0},l=a=>{if(a.backend_state_sync)f.for(a.category).set(a.name,a.value,!0);else if(a.backend_state_sync_all){var b=f.for(a.category).values;for(var c in b)k({backend_state_sync:!0,category:a.category,name:c,value:b[c]})}else if(a.backend_state_call){c=a.args;for(var e in c){let d=c[e];"string"===typeof d&&d.startsWith("proxy-function")&&(c[e]=function(){const g=[...arguments];k({backend_state_callback:!0,category:a.category,
function:d,args:g})})}for(b of f.for(a.category)._listeners(a.name,!0))e=b(c),"function"===typeof e?.then?e.then(function(){const d=[...arguments];k({backend_state_callback:!0,category:a.category,function:a.promiseResolve,args:d})}).catch(d=>{k({backend_state_callback:!0,category:a.category,function:a.promiseReject,args:[{name:d.name,message:d.message}]})}):k({backend_state_callback:!0,category:a.category,function:a.promiseResolve,args:[e]})}else a.backend_state_callback&&(b=f.for(a.category).callbacks[a.function])&&
b.apply(null,a.args)},k=a=>{if(Utils.isEmbed())l(a);else{if(!f.port)throw Error("No proxyPort to post message!");f.port.postMessage(a)}},r=(a,b,c)=>{let e=f.callId++;for(let d in c){let g=c[d];if("function"===typeof g){let h="proxy-function-"+b+"-"+e+"-"+d;f.for(a).callbacks[h]=g;c[d]=h}}return new Promise(function(d,g){var h="proxy-function-promise-"+b+"-"+e;let m=h+"-resolve";h+="-reject";f.for(a).callbacks[m]=d;f.for(a).callbacks[h]=n=>{let p=Error(n.message);p.name=n.name;g(p)};k({backend_state_call:!0,
id:e,category:a,name:b,args:c,promiseResolve:m,promiseReject:h})})},q=a=>{f.port=a;a.onMessage.addListener(function(b){b.keepAlive||l(b)})};f.for=a=>{let b=f.categories[a];b||(b=f.categories[a]={values:{},listeners:[],callbacks:{},connected:void 0},b.set=(c,e,d)=>{d||k({backend_state_sync:!0,category:a,name:c,value:e});b.values[c]=e;for(let g in b._listeners(c))g(e)},b.get=(c,e)=>{let d=b.values[c];return void 0===d?(void 0===e&&console.error("No value defined for category: "+a+" name: "+c),e):d},
b.call=(c,e)=>r(a,c,e),b.listen=(c,e)=>{let d=b.listeners[c];d||=b.listeners[c]=[];d.push(e)},b.connect=c=>{b.connected=c;c.set=(e,d)=>{b.set(e,d)};c.get=e=>b.get(e);return b},b.sync=()=>{k({backend_state_sync_all:!0,category:a});return b},b._listeners=(c,e)=>{let d=b.listeners[c];d||=[];d=[].concat(d);if(b.connected&&b.connected[c]){let g=b.connected[c];e&&0===d.length&&"function"===typeof g?d.push(g):e||d.push(h=>{g[c]=h})}return d});return b};if(Utils.isEmbed())return f;if("undefined"!==typeof navigator.mediaDevices){let a=
void 0;function b(){let c=chrome.runtime.connect({name:"proxyPort"});q(c);a&&clearInterval(a);a=setInterval(()=>{c.postMessage({keepAlive:!0})},25E3);c.onDisconnect.addListener(b)}b();return f}chrome.runtime.onConnect.addListener(function(a){"proxyPort"===a.name&&q(a)});return f}();