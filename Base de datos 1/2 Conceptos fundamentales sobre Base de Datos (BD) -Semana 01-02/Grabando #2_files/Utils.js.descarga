'use strict';self.Utils=function(){let c={waitingResponse:[],responseListener:void 0,queueMessages:{},failedInjecting:{},sendMessageNoLoggingOnError:()=>{}},h="undefined"!==typeof document?document.location.pathname:"service-worker";"service-worker"===h||-1===h.indexOf("background.js")||RuntimeParams.isDebug()||(console=function(){function a(b,d){c.sendMessageToBackground({logMessage:{type:b,text:d,page:h}})}return{log:function(b){a("DEBUG",b)},info:function(b){a("INFO",b)},warn:function(b){a("WARN",
b)},error:function(b,d){let f="",e=Error().stack.split("\n"),g=3;d&&"string"===typeof d.stack&&(e=d.stack.split("\n"),g=0);for(let k of e)0<g--||(f+=k+"\n");d=f.trim();a("ERROR",b+"\n"+d)}}}());c.isEmbed=function(){return null!==RuntimeParams.getBase()};c.stopStream=function(a){a&&a.getTracks().forEach(function(b){b.stop()})};c.hasAudioTrack=function(a){return a&&0<a.getAudioTracks().length};c.reportEvent=function(a,b){c.sendMessageToBackground({reportEvent:a,props:b})};c.sendMessageToBackground=
function(a,b){if(c.isEmbed()){if(b){let d=(new Date).getTime()+"-"+Math.floor(1E3*Math.random());c.waitingResponse[d]=b;a.responseListenerId=d;c.responseListener||c.receiveMessages(c.responseListener=function(f){"responseListenerId"in f&&(c.waitingResponse[f.responseListenerId](f),c.waitingResponse[f.responseListenerId]=void 0)})}a.forwardToBackground=!0;b=(new URL(document.location)).searchParams.get("utilsBackgroundDepth");"3"===b?parent.parent.parent.postMessage(a,"*"):"2"===b?parent.parent.postMessage(a,
"*"):parent.postMessage(a,"*")}else chrome.runtime.sendMessage(a,b)};c.setFailedToSetupTabId=function(a){return c.failedInjecting["tab-"+a]?!1:c.failedInjecting["tab-"+a]=!0};c.setQueueMessagesForTabId=function(a){if(c.failedInjecting["tab-"+a])return!0;if(c.queueMessages["tab-"+a])return!1;c.queueMessages["tab-"+a]=[];return!0};c.clearQueueMessagesForTabId=function(a,b){let d=c.queueMessages["tab-"+a];delete c.failedInjecting["tab-"+a];delete c.queueMessages["tab-"+a];if(b)for(let f of d)f()};c.sendMessage=
function(a,b,d){if(c.isEmbed())"active"!==b&&void 0!==b&&"script-tab"!==b||parent.postMessage(a,"*");else if("inactive"!==b||d||(d=function(){}),b){let f=function(e,g){c.queueMessages["tab-"+e]?(console.log("Tabs sendMessage queing: (tabId: "+e+" msg: "+JSON.stringify(g)),c.queueMessages["tab-"+e].push(function(){f(e,g)})):chrome.tabs.sendMessage(e,g,function(){chrome.runtime.lastError&&"The message port closed before a response was received."!==chrome.runtime.lastError.message&&(d?d():console.error("Tabs sendMessage error: "+
chrome.runtime.lastError.message+"(tabId: "+e+" msg: "+JSON.stringify(g)))})};"script-tab"===b?chrome.tabs.getCurrent(function(e){console.log("Sending message to my tab: "+b+" (data: "+JSON.stringify(a)+")");f(e.id,a)}):"active"!==b&&"inactive"!==b?(d!==c.sendMessageNoLoggingOnError&&console.log("Sending message to particular tab: "+b+" (data: "+JSON.stringify(a)+")"),f(b,a)):chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(e&&0<e.length){let g=e[0].id;"active"===b?(console.log("Sending message to active tab: "+
g+" (data: "+JSON.stringify(a)+")"),f(g,a)):(console.log("Sending message to all inactive tabs. (data: "+JSON.stringify(a)+")"),chrome.tabs.query({},function(k){for(let l of k)l.id!==g&&f(l.id,a)}))}else console.error("Failed to find active tab so can't send msg (data: "+JSON.stringify(a)+")")})}else console.log("Sending message to all tabs. (data: "+JSON.stringify(a)+")"),chrome.tabs.query({},function(f){for(let e of f)chrome.tabs.sendMessage(e.id,a,function(){chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."!==
chrome.runtime.lastError.message&&d&&d()})})};c.sendMessageNoLogging=function(a,b){c.sendMessage(a,b,c.sendMessageNoLoggingOnError)};c.receiveMessages=function(a){if(c.isEmbed()){let b=function(d){d=d.data;"object"===typeof d&&a(d)};addEventListener?addEventListener("message",b,!1):attachEvent&&attachEvent("onmessage",b)}else chrome.runtime.onMessage.addListener(function(b,d){d.id===chrome.runtime.id&&a(b)})};c.receiveMessagesInBackground=function(a){if(c.isEmbed()){let b=function(d){let f=d.data;
"object"===typeof f&&a(f,void 0,function(e){"responseListenerId"in f&&(e.responseListenerId=f.responseListenerId,c.sendMessage(e))})};addEventListener?addEventListener("message",b,!1):attachEvent&&attachEvent("onmessage",b)}else chrome.runtime.onMessage.addListener(function(b,d,f){return a(b,d,f)})};c.formatMSToSec=function(a){let b=new Date(0);b.setSeconds(a/1E3);return b.toISOString().substr(11,8).replace(/^(?:00:)?0?/,"")};c.delay=function(a){return new Promise(function(b){setTimeout(function(){b()},
a)})};c.getVideoImageRect=function(a,b,d,f){var e=1*d/a;var g=1*f/b;a===d&&b===f?(e=a,g=b):1!==g||1!==e?Math.round(1E3*g)<Math.round(1E3*e)?(e=Math.round(a*g),g=Math.round(b*e/a)):(g=Math.round(b*e),e=Math.round(a*g/b)):(e=a,g=b);return{x:(d-e)/2,y:(f-g)/2,w:e,h:g}};c.isFirefox=function(){return 0<navigator.userAgent.toLowerCase().indexOf("firefox")};c.isChromium=function(){return 0<navigator.userAgent.toLowerCase().indexOf("chrome")};return c}();